<!doctype html>
<html lang="en">
<head>
<title>Openbox</title>
<link rel=stylesheet type=text/css href="{{ url_for('static', filename='bootstrap-responsive.min.css') }}">
<link rel=stylesheet type=text/css href="{{ url_for('static', filename='bootstrap.min.css') }}">
<link href="{{ url_for('static', filename='prettify.css') }}" type="text/css" rel="stylesheet" />
<style media="screen" type="text/css">

#top-link  { display:none; position:fixed; right:14px; bottom:5px; }

</style>


<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script type="text/javascript" src="{{ url_for('static', filename="prettify.js") }}"></script>
<script src="{{ url_for('static', filename='bootstrap.min.js') }}"></script>
<script src="{{ url_for('static', filename='jquery.scrollTo-1.4.3.1-min.js') }}"></script>
<script src="http://d1n0x3qji82z53.cloudfront.net/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    "use strict";

    $(document).ready(function () {
        $("#api-call").submit(function (e) {
            e.preventDefault();
            $.ajax({
                type: "POST",
                url: "make-api-call",
                data : $(this).serialize(),
                dataType: "json",
                cache: false,
                complete: function (data) {
                    var response = $.parseJSON(data.responseText);
                    $("#response").text(response["json"]);
                    $("#response_headers").text(response["headers"]);
                    prettyPrint();
                    $("#http-cat").attr("src","http://httpcats.herokuapp.com/" + response["status"]);
                }
            })
            return false;
        });

    });

    $(document).delegate('#json_body', 'keydown', function(e) {
      var keyCode = e.keyCode || e.which;

      if (keyCode == 9) {
        e.preventDefault();
        var start = $(this).get(0).selectionStart;
        var end = $(this).get(0).selectionEnd;

        // set textarea value to: text before caret + tab + text after caret
        $(this).val($(this).val().substring(0, start)
                    + "\t"
                    + $(this).val().substring(end));

        // put caret at right position again
        $(this).get(0).selectionStart =
        $(this).get(0).selectionEnd = start + 1;
      }
    });

    //plugin
    $.fn.topLink = function(settings) {
        settings = $.extend({
          min: 1,
          fadeSpeed: 200,
          ieOffset: 50
        }, settings);
        return this.each(function() {
          //listen for scroll
          var el = $(this);
          el.css('display','none'); //in case the user forgot
          $(window).scroll(function() {
            //stupid IE hack
            if(!$.support.hrefNormalized) {
              el.css({
                'position': 'absolute',
                'top': $(window).scrollTop() + $(window).height() - settings.ieOffset
              });
            }
            if($(window).scrollTop() >= settings.min)
            {
              el.fadeIn(settings.fadeSpeed);
            }
            else
            {
              el.fadeOut(settings.fadeSpeed);
            }
          });
        });
      };

    //usage w/ smoothscroll
    $(document).ready(function() {
      //set the link
      $('#top-link').topLink({
        min: 400,
        fadeSpeed: 500
      });
      //smoothscroll
      $('#top-link').click(function(e) {
        e.preventDefault();
        $.scrollTo(0,300);
      });
    });
</script>
</head>
<body>
<div class="container-fluid">
    <div class="navbar">
      <div class="navbar-inner">
        <a class="brand" href="#">Box API Console</a>
      </div>
    </div>
    <div class="row-fluid">
        <fieldset>
            <form class="form span12" id="api-call" action="make-api-call" method="POST">
                {{ form.csrf_token }}
                    <div class="row-fluid">
                        <div class="span12">
                            <select class="span2" id="method" name="method">
                                <option>GET</option>
                                <option>POST</option>
                                <option>PUT</option>
                                <option>DELETE</option>
                                <option>OPTIONS</option>
                            </select>
                            <div class="input-prepend">
                                <span class="add-on">https://api.box.com/2.0</span>
                                <input class="input-xlarge" id="url" name="url" type="text" placeholder="/folders/0">
                            </div>
                            <input class="input pull-right span3" type="text" name="access_token" id="access_token" placeholder="Access Token">
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span12">
                        <textarea id="json_body" rows="6" class="input-block-level" id="body" name="body" placeholder="JSON Body"></textarea>
                        </div>
                    <div class="row-fluid">
                        <button type="submit" class="btn btn-success btn-large btn-block">Make API Call <i class="icon-arrow-right icon-white"></i></button>
                    </div>
              </fieldset>
            </form>
        </fieldset>
    <div class="row-fluid">
        <div class="span12">
            <div class="tabbable tabs-right">
                <ul class="nav nav-tabs" id="output">
                    <li class="active"><a href="#json" data-toggle="tab">JSON</a></li>
                    <li><a href="#headers" data-toggle="tab">Headers</a></li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="json">
                        <pre id="response" class="prettyprint lang-javascript"></pre>
                    </div>
                    <div class="tab-pane" id="headers">
                        <pre id="response_headers" class="prettyprint lang-javascript pre-scrollable"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <div class="row-fluid">
        <div class="span10">
            <img id="http-cat" src="" class="img-rounded">
        </div>
    </div>
</div>
<a class="btn btn-large btn-inverse" href="#top" id="top-link"><i class="icon-chevron-up icon-white"></i></a>
</body>
</html>